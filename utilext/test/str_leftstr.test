#===============================================================================
#
# Written by: Mark Benningfield
#
# LICENSE: Public Domain -- see the file LICENSE.txt
#
#===============================================================================
#
# Tests for the leftstr() function
#
#===============================================================================

source errors.tcl
setup db


test src_null {Verify NULL return for NULL arg} -body {
  return [elem0 [db eval {select leftstr(NULL, 3);}]]
} -result NULL


test len_null {Verify input return for NULL length arg} -body {
  return [elem0 [db eval {select leftstr('Hello World', NULL);}]]
} -result {Hello World}


test len_long {Verify input return for over-long length arg} -body {
  return [elem0 [db eval {select leftstr('Hello World', 14);}]]
} -result {Hello World}


test left {Verify normal result} -body {
  return [elem0 [db eval {select leftstr('Hello World', 6);}]]
} -result {Hello }


test len_low {Verify error on invalid length arg} -body {
  db eval {select leftstr('Hello World', -1);}
} -returnCodes 1 -result $SqliteMisuse


test len_text {Verify conversion to int from text on length arg} -body {
  return [elem0 [db eval {select leftstr('Brown Cow', '4');}]]
} -result Brow


test len_real {Verify conversion to int from real on length arg} -body {
  return [elem0 [db eval {select leftstr('Brown Cow', 3.2);}]]
} -result Bro


test unicode {Verify actual character count on unicode text} -body {
  setup_unicode8 pdb
  set a [pdb eval {select leftstr(source, 10) from test_leftstr1;}]
  set b [pdb eval {select result from test_leftstr1;}]
  pdb close
  return [string equal $a $b]
} -result {1}


test unicode_long_chars {Verify that a length > char count but < byte count returns input} -body {
  setup_unicode8 pdb
  set a [pdb eval {select leftstr(source, 32) from test_leftstr2;}]
  set b [pdb eval {select result from test_leftstr2;}]
  pdb close
  return [string equal $a $b]
} -result {1}


db close
tcltest::cleanupTests
